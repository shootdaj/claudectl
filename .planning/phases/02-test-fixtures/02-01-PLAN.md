---
phase: 02-test-fixtures
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - sandbox/fixtures/.claude/.claude.json
  - sandbox/fixtures/.claude/projects/-sandbox-scratch-session1/scratch-session.jsonl
  - sandbox/fixtures/.claude/projects/-Users-dev-webapp/project-session.jsonl
  - sandbox/fixtures/.claude/projects/-Users-dev-webapp/empty-session.jsonl
  - sandbox/fixtures/.claude/projects/-Users-dev-api/multiday-session.jsonl
  - sandbox/fixtures/.claude/projects/-Users-dev-api/expensive-session.jsonl
  - sandbox/fixtures/README.md
autonomous: true

must_haves:
  truths:
    - "Fixture session files parse as valid JSONL with correct message schema"
    - "Mock .claude.json contains valid MCP server configurations"
    - "At least one scratch session and one project session exist"
    - "Edge cases are represented (empty, multi-day, high-cost sessions)"
  artifacts:
    - path: "sandbox/fixtures/.claude/.claude.json"
      provides: "Mock MCP server configuration"
      contains: "mcpServers"
    - path: "sandbox/fixtures/.claude/projects/-sandbox-scratch-session1/scratch-session.jsonl"
      provides: "Scratch session fixture"
      min_lines: 3
    - path: "sandbox/fixtures/.claude/projects/-Users-dev-webapp/project-session.jsonl"
      provides: "Project session with tool use"
      min_lines: 10
    - path: "sandbox/fixtures/.claude/projects/-Users-dev-webapp/empty-session.jsonl"
      provides: "Empty session edge case"
      min_lines: 1
    - path: "sandbox/fixtures/.claude/projects/-Users-dev-api/multiday-session.jsonl"
      provides: "Multi-day conversation session"
      min_lines: 8
    - path: "sandbox/fixtures/.claude/projects/-Users-dev-api/expensive-session.jsonl"
      provides: "High-cost session edge case"
      min_lines: 4
  key_links:
    - from: "sandbox/fixtures/.claude/.claude.json"
      to: "src/core/mcp.ts MCPServer type"
      via: "Same JSON schema for mcpServers"
      pattern: '"command"|"url"'
    - from: "sandbox/fixtures/.claude/projects/**/*.jsonl"
      to: "src/test-fixtures/sessions/sample-session.jsonl"
      via: "Same JSONL message schema"
      pattern: '"type":"(user|assistant|summary)"'
---

<objective>
Create realistic test fixtures for Docker sandbox testing, including sample session files and mock MCP configuration.

Purpose: Provide reproducible sample data that Phase 3 can copy into Docker containers for testing various scenarios (normal sessions, scratch sessions, edge cases).
Output: A `sandbox/fixtures/` directory with complete Claude Code data structure ready for Docker volume mounting.
</objective>

<execution_context>
@/Users/anshul/.claude/get-shit-done/workflows/execute-plan.md
@/Users/anshul/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Reference existing JSONL format
@src/test-fixtures/sessions/sample-session.jsonl

# Reference MCP type definitions
@src/core/mcp.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create fixture directory structure and mock .claude.json</name>
  <files>
    sandbox/fixtures/.claude/.claude.json
    sandbox/fixtures/README.md
  </files>
  <action>
Create the sandbox fixtures directory structure:
```
sandbox/fixtures/
├── .claude/
│   ├── .claude.json          # Mock MCP config
│   └── projects/             # Will contain session directories
└── README.md                 # Documents fixture purpose and usage
```

Create `sandbox/fixtures/.claude/.claude.json` with sample MCP servers:
- One stdio server (e.g., "filesystem" with npx command)
- One HTTP server (e.g., "demo-api" with URL)
- Include projects section with local-scope server example

Format must match MCPServer types from src/core/mcp.ts:
```json
{
  "mcpServers": {
    "filesystem": {
      "command": "npx",
      "args": ["-y", "@anthropic/mcp-server-filesystem", "/sandbox"]
    },
    "demo-api": {
      "url": "http://localhost:3000/mcp"
    }
  },
  "projects": {
    "/sandbox/myproject": {
      "mcpServers": {
        "local-db": {
          "command": "npx",
          "args": ["-y", "mcp-server-sqlite", "/sandbox/myproject/data.db"]
        }
      }
    }
  }
}
```

Create `sandbox/fixtures/README.md` documenting:
- Purpose of fixtures directory
- How to use with Docker (copy into /sandbox/.claude/)
- Description of each sample session type
  </action>
  <verify>
```bash
# Verify .claude.json is valid JSON
cat sandbox/fixtures/.claude/.claude.json | bun -e "console.log(JSON.parse(require('fs').readFileSync(0, 'utf8')).mcpServers ? 'Valid' : 'Invalid')"
# Verify README exists
test -f sandbox/fixtures/README.md && echo "README exists"
```
  </verify>
  <done>
Mock .claude.json exists with valid MCP server configurations (stdio and HTTP types), README documents the fixtures.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create sample session fixtures covering all scenarios</name>
  <files>
    sandbox/fixtures/.claude/projects/-sandbox-scratch-session1/scratch-session.jsonl
    sandbox/fixtures/.claude/projects/-Users-dev-webapp/project-session.jsonl
    sandbox/fixtures/.claude/projects/-Users-dev-webapp/empty-session.jsonl
    sandbox/fixtures/.claude/projects/-Users-dev-api/multiday-session.jsonl
    sandbox/fixtures/.claude/projects/-Users-dev-api/expensive-session.jsonl
  </files>
  <action>
Create sample session files following the JSONL schema from src/test-fixtures/sessions/sample-session.jsonl.

**1. Scratch session** (`-sandbox-scratch-session1/scratch-session.jsonl`):
- Path encoding represents `/sandbox/scratch-session1` (scratch directory)
- 3-4 messages: quick question-answer exchange
- No gitBranch (scratch sessions don't have git)
- Low token counts

**2. Project session with tool use** (`-Users-dev-webapp/project-session.jsonl`):
- Path encoding represents `/Users/dev/webapp`
- 8-10 messages including tool_use examples
- Has gitBranch: "main"
- Include file-history-snapshot at start
- Include assistant message with tool_use array (Read, Write tools)
- Medium token counts, ~$0.05 total cost

**3. Empty session edge case** (`-Users-dev-webapp/empty-session.jsonl`):
- Single file-history-snapshot message only
- No user/assistant messages
- Tests handling of sessions with no conversation

**4. Multi-day conversation** (`-Users-dev-api/multiday-session.jsonl`):
- Path encoding represents `/Users/dev/api`
- Messages spanning 3 different days (use timestamps like 2025-12-17, 2025-12-18, 2025-12-19)
- Include a "summary" type message (conversation compression)
- 8+ messages total
- Tests session date range display

**5. High-cost session** (`-Users-dev-api/expensive-session.jsonl`):
- Same project as #4 (different session file)
- 4-6 messages with very high token counts
- Total cost > $1.00 (use large input_tokens and cache values)
- Tests cost display formatting

Each message MUST have these fields:
- `type`: "user" | "assistant" | "summary" | "file-history-snapshot"
- `uuid`: unique message ID
- `parentUuid`: previous message UUID (null for first)
- `sessionId`: matches filename without .jsonl
- `timestamp`: ISO 8601 format
- `cwd`: working directory path

Assistant messages MUST include:
- `message.role`: "assistant"
- `message.model`: "claude-opus-4-5-20251101" or "claude-sonnet-4-20250514"
- `message.content`: array with {type: "text", text: "..."} objects
- `message.usage`: {input_tokens, output_tokens, cache_creation_input_tokens?, cache_read_input_tokens?}
  </action>
  <verify>
```bash
# Verify each session file is valid JSONL (each line parses as JSON)
for f in sandbox/fixtures/.claude/projects/*/*.jsonl; do
  echo "Checking $f..."
  while IFS= read -r line; do
    echo "$line" | bun -e "JSON.parse(require('fs').readFileSync(0, 'utf8'))" 2>/dev/null || echo "INVALID: $line"
  done < "$f"
done

# Count session files (should be 5)
find sandbox/fixtures/.claude/projects -name "*.jsonl" | wc -l

# Verify scratch session has no gitBranch
grep -L "gitBranch" sandbox/fixtures/.claude/projects/-sandbox-*/scratch-session.jsonl && echo "Scratch has no gitBranch (correct)"

# Verify multi-day has summary message
grep -l '"type":"summary"' sandbox/fixtures/.claude/projects/-Users-dev-api/multiday-session.jsonl && echo "Multi-day has summary"
```
  </verify>
  <done>
5 session fixtures exist covering: scratch session, project session with tools, empty session, multi-day conversation with summary, high-cost session. All files parse as valid JSONL.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

```bash
# 1. Full directory structure exists
tree sandbox/fixtures/

# 2. All fixtures can be parsed by claudectl's JSONL parser
bun -e "
const { readdirSync, readFileSync } = require('fs');
const { join } = require('path');

const projectsDir = 'sandbox/fixtures/.claude/projects';
const dirs = readdirSync(projectsDir);
let total = 0;
for (const dir of dirs) {
  const files = readdirSync(join(projectsDir, dir)).filter(f => f.endsWith('.jsonl'));
  for (const file of files) {
    const path = join(projectsDir, dir, file);
    const lines = readFileSync(path, 'utf8').trim().split('\n');
    for (const line of lines) {
      JSON.parse(line); // Will throw if invalid
    }
    total++;
    console.log('OK:', path, '(' + lines.length + ' messages)');
  }
}
console.log('Total sessions:', total);
"

# 3. MCP config has expected structure
bun -e "
const config = require('./sandbox/fixtures/.claude/.claude.json');
console.log('User MCP servers:', Object.keys(config.mcpServers || {}).length);
console.log('Projects with local MCPs:', Object.keys(config.projects || {}).length);
"
```
</verification>

<success_criteria>
1. `sandbox/fixtures/.claude/.claude.json` exists with valid MCP server configurations
2. 5 session fixture files exist covering all required scenarios
3. All JSONL files parse without errors
4. At least one scratch session (no gitBranch) and one project session (with gitBranch)
5. Edge cases represented: empty session, multi-day with summary, high-cost
6. README.md documents fixture structure and usage
</success_criteria>

<output>
After completion, create `.planning/phases/02-test-fixtures/02-01-SUMMARY.md`
</output>
